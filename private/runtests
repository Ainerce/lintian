#!/bin/sh

set -e

if [ "$LINTIAN_TEST_INSTALLED" = "yes" ]; then
    LINTIAN_FRONTEND="/usr/bin/lintian"
    LINTIAN_TEST_ROOT="/usr/share/lintian"
else
    unset LINTIAN_FRONTEND
    LINTIAN_TEST_ROOT="$(pwd)"
fi

if [ "$1" = "-j" ] ; then
    NUMJOBS="$2"
    test "$NUMJOBS" -gt 0 || (
        echo "$NUMJOBS is not an integer greater than 0" >&2 && exit 1)
    PARALLEL_ARGS="-j $NUMJOBS"
    shift
    shift
fi

LC_ALL="C"
LINTIAN_PROFILE=debian
NO_PKG_MANGLE=true
unset MAKEFLAGS
# Ensure Lintian works without $ENV{HOME}
unset HOME

[ "$TEST_WORK_DIR" ] || TEST_WORK_DIR="debian/test-out"

export LC_ALL
export LINTIAN_FRONTEND
export LINTIAN_TEST_ROOT
export LINTIAN_PROFILE
export NO_PKG_MANGLE

fail(){
    echo "$1" >&2
    exit 1
}

t/runtests --dump-logs -k $PARALLEL_ARGS t "$TEST_WORK_DIR" "$@"

# Local Variables:
# indent-tabs-mode: nil
# End:
# vim: syntax=sh sw=4 sts=4 sr et
