#!/usr/bin/make -f

lib_tmp=debian/tmp-lib
dev_tmp=debian/tmp-dev

LIB=libbaz1
DEV=libbaz1-dev

build:

clean:
	rm -f debian/files debian/substvars
	rm -rf $(lib_tmp) $(dev_tmp)

binary-arch: build
	# first, the lib package
	install -d $(lib_tmp)/usr/lib
	install -d $(lib_tmp)/usr/share/doc/$(LIB)
	install -m 644 debian/copyright $(lib_tmp)/usr/share/doc/$(LIB)
	install -m 644 debian/changelog $(lib_tmp)/usr/share/doc/$(LIB)
	gzip -9 $(lib_tmp)/usr/share/doc/$(LIB)/changelog
	install -d $(lib_tmp)/DEBIAN
	install -m 755 debian/lib.postinst $(lib_tmp)/DEBIAN/postinst
	install -m 755 debian/lib.prerm $(lib_tmp)/DEBIAN/prerm
	touch $(lib_tmp)/usr/share/doc/README.Debian
	#dpkg-shlibdeps $(lib_tmp)/usr/lib/libbaz.so.1.0
	dpkg-gencontrol -isp -p$(LIB) -P$(lib_tmp)
	dpkg --build $(lib_tmp) ..

	# now the -dev package
	install -d $(dev_tmp)/usr/include
	install -d $(dev_tmp)/usr/share/doc
	ln -s $(LIB) $(dev_tmp)/usr/share/doc/$(DEV) 
	install -d $(dev_tmp)/DEBIAN
	install -m 755 debian/dev.postinst $(dev_tmp)/DEBIAN/postinst
	install -m 755 debian/dev.prerm $(dev_tmp)/DEBIAN/prerm
	dpkg-gencontrol -isp -p$(DEV) -P$(dev_tmp)
	dpkg --build $(dev_tmp) ..

binary: binary-arch

.PHONY: build binary-arch binary clean
