#!/usr/bin/make -f

# Copyright (C) 1998 Richard Braakman
# 
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 2 of the License, or
# (at your option) any later version.
# 
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
# 
# You should have received a copy of the GNU General Public License
# along with this program.  If not, you can find it on the World Wide
# Web at http://www.gnu.org/copyleft/gpl.html, or write to the Free
# Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston,
# MA 02110-1301, USA.

clean:
	mkdir -p .svn CVS "{arch}" .arch-ids .bzr
	touch files/.cvsignore files/svn-commit.tmp
	touch files/.arch-inventory
	touch 'files/.#Maelstrom Sound.1.1.1' 'files/Maelstrom Sounce.r121'
	touch 'files/Maelstrom Sound.mine'

build:

binary-arch:

binary-indep:
	install -d debian/tmp/DEBIAN
	cp -a files debian/tmp
	chmod -R go=rX debian/tmp/files

	install -d debian/tmp/usr/lib/filenames
	install -m 555 -d debian/tmp/usr/lib/filenames/readonly
	touch debian/tmp/usr/lib/filenames/readonly/test

	install -d debian/tmp/usr/lib/menu
	install -d debian/tmp/usr/share/menu
	touch debian/tmp/usr/lib/menu/README
	touch debian/tmp/usr/share/menu/README
	touch debian/tmp/usr/lib/menu/menu
	touch debian/tmp/usr/share/menu/menu
	chmod 644 debian/tmp/usr/lib/menu/*

	install -d debian/tmp/usr/lib/perl5/foo
	mkdir debian/tmp/usr/lib/perl5/.svn
	mkdir debian/tmp/usr/lib/perl5/CVS
	mkdir "debian/tmp/usr/lib/perl5/{arch}"
	mkdir debian/tmp/usr/lib/perl5/.arch-ids
	mkdir debian/tmp/usr/lib/perl5/.bzr

	touch debian/tmp/usr/lib/perl5/foo/.packlist
	chmod 644 debian/tmp/usr/lib/perl5/foo/.packlist
	touch debian/tmp/usr/lib/perl5/foo/bar.pm
	touch -t 197501010101 debian/tmp/usr/lib/perl5/foo/ancient.pm
	chmod 644 debian/tmp/usr/lib/perl5/foo/bar.pm

	install -d debian/tmp/usr/share/pixmaps
	install -d debian/tmp/usr/share/pixmaps/foo
	touch debian/tmp/usr/share/pixmaps/license.jpeg
	touch debian/tmp/usr/share/pixmaps/licence.jpg
	touch debian/tmp/usr/share/pixmaps/copying.xpm
	touch debian/tmp/usr/share/pixmaps/foo/COPYING.svg
	touch debian/tmp/usr/share/pixmaps/foo/copying.png
	touch debian/tmp/usr/share/pixmaps/license.txt
	touch debian/tmp/usr/share/pixmaps/license.foo
	touch debian/tmp/usr/share/pixmaps/COPYING

	install -d debian/tmp/usr/share/doc/filenames
	touch debian/tmp/usr/share/doc/filenames/README.macosx

	echo foo > debian/tmp/usr/share/doc/filenames/bokmÃ¥l
	echo foo > debian/tmp/usr/share/doc/filenames/bokm\\Ã¥l
	echo foo > debian/tmp/usr/share/doc/filenames/bokm\\\\Ã¥l
	echo foo > debian/tmp/usr/share/doc/filenames/bokmål
	echo foo > debian/tmp/usr/share/doc/filenames/bokm\\ål
	echo foo > debian/tmp/usr/share/doc/filenames/bokm\\\\ål

	install -d debian/tmp/usr/share/doc/filenames/examples
	touch debian/tmp/usr/share/doc/filenames/examples/__init__.py
	touch debian/tmp/usr/share/doc/filenames/examples/very_interesting_example
	touch debian/tmp/usr/share/doc/filenames/examples/very_interesting_example2
	gzip debian/tmp/usr/share/doc/filenames/examples/very_interesting_example2

	install -d debian/tmp/usr/lib/ada/adalib/
	touch debian/tmp/usr/lib/ada/adalib/test.ali debian/tmp/usr/lib/ada/adalib/test2.ali
	chmod 0644 debian/tmp/usr/lib/ada/adalib/test.ali
	chmod 0444 debian/tmp/usr/lib/ada/adalib/test2.ali

	install -d debian/tmp/usr/bin/X11/
	touch debian/tmp/usr/bin/X11/testxbin
	install -d debian/tmp/usr/X11R6/bin
	touch debian/tmp/usr/X11R6/bin/testxbin2
	install -d debian/tmp/usr/include/X11
	touch debian/tmp/usr/include/X11/foo.h

	install -m 644 debian/changelog debian/tmp/usr/share/doc/filenames/Changes
	gzip -9 debian/tmp/usr/share/doc/filenames/Changes
	ln -s Changes.gz debian/tmp/usr/share/doc/filenames/changelog.gz

	install -d debian/tmp/srv/foo
	touch debian/tmp/srv/foo/bar

	install -d debian/tmp/etc/gconf/schemas
	touch debian/tmp/etc/gconf/schemas/test.schema

	ln -s '../filenames/doc/version6.txt.gz' debian/tmp/usr/share/doc/filenames/version.txt.gz
	ln -s ../../share/symlink debian/tmp/usr/lib/filenames/symlink1ok
	ln -s ../../../etc/symlink debian/tmp/usr/lib/filenames/symlink1wrong
	ln -s ../../../../etc/symlink debian/tmp/usr/lib/filenames/symlink2wrong
	ln -s /etc/symlink debian/tmp/usr/lib/filenames/symlink2ok
	ln -s /usr/lib/filenames/symlink2 debian/tmp/usr/lib/filenames/symlink3wrong
	ln -s test debian/tmp/usr/lib/filenames/symlink3ok
	ln -s ../filenames/symlink2 debian/tmp/usr/lib/filenames/symlink4wrong
	ln -s ../menu/../somethingelse debian/tmp/usr/lib/filenames/symlink5wrong
	ln -s ../menu/somethingelse debian/tmp/usr/lib/filenames/symlink4ok
	ln -s ./file4 debian/tmp/usr/lib/filenames/symlink6wrong
	ln -s ../menu/./something debian/tmp/usr/lib/filenames/symlink7wrong
	ln -s ../menu//something debian/tmp/usr/lib/filenames/symlink8wrong
	ln -s ../menu/something/ debian/tmp/usr/lib/filenames/symlink9wrong
	ln -s .. debian/tmp/usr/lib/filenames/symlink5ok+warn
	ln -s . debian/tmp/usr/lib/filenames/symlink6ok+warn
	ln -s / debian/tmp/usr/lib/filenames/symlink7ok+warn
	ln -s ../../.. debian/tmp/usr/lib/filenames/symlink10wrong

# Running dpkg-gencontrol without any options used to omit the section and
# priority from the .dsc file.  Now, as of 1.13.16, -isp is the default.
# Stimulate the same lintian check by explicitly omitting the fields.
	dpkg-gencontrol -Usection -Upriority
	dpkg --build debian/tmp ..

binary: binary-arch binary-indep

.PHONY: build binary-arch binary-indep binary clean
